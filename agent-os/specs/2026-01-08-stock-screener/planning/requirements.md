# Spec Requirements: 銘柄スクリーニングツール

## Initial Description
日本株および米国株を対象とした銘柄スクリーニングツールの開発。投資家が複数の財務指標や条件を組み合わせて銘柄を検索・フィルタリングできるWebアプリケーション。

## Requirements Discussion

### 第1ラウンド質問

**Q1:** 対象とする市場はどこですか？
**回答:** 日本株及び米国株

**Q2:** データソースは何を使用しますか？
**回答:** Yahoo Finance API（非公式のyfinanceライブラリまたはサードパーティAPI）

**Q3:** どのようなフィルタリング条件を提供しますか？
**回答:**
- 時価総額（範囲指定）
- PER、PBR、ROE（範囲指定）
- 配当利回り（範囲指定）
- 業種・セクター（選択式）
- 株価（範囲指定）

**Q4:** UIの形式はどのようなものを想定していますか？
**回答:** フォーム形式で条件入力、検索ボタンクリックで結果表示

**Q5:** 検索結果はどのように表示しますか？
**回答:** テーブル形式、ソート機能、ページネーション

**Q6:** スクリーニング条件の保存機能は必要ですか？
**回答:** 不要

**Q7:** 認証・ログイン機能は必要ですか？
**回答:** ログイン不要

**Q8:** 市場（日本株/米国株）の切り替えはどのように行いますか？
**回答:** タブ切り替え方式（日本株/米国株）

**Q9:** データの更新頻度はどうしますか？
**回答:** 手動更新ボタン方式（コスト削減のため）

**Q10:** 既存コードで参照すべき類似機能はありますか？
**回答:** なし（新規プロジェクト）

**Q11:** スコープ外とする機能はありますか？
**回答:**
- チャート表示
- テクニカル分析
- ポートフォリオ管理
- アラート通知
（これらは今後の展望として記載）

### 既存コードの参照
**類似機能の特定:**
なし（新規プロジェクトのため既存コードはありません）

### フォローアップ質問
フォローアップ質問は不要でした。全ての必要な情報が初回で収集されました。

## Visual Assets

### 提供されたファイル:
ビジュアルアセットの提供はありませんでした。

### ビジュアル分析:
該当なし

## Requirements Summary

### 機能要件

**コア機能:**
- 日本株および米国株を対象とした銘柄スクリーニング
- 複数の財務指標による絞り込み機能
- 検索結果のテーブル表示とソート・ページネーション
- 市場切り替え機能（タブ方式）
- データの手動更新機能

**フィルタリング条件:**
1. **時価総額** - 範囲指定（最小値〜最大値）
2. **PER（株価収益率）** - 範囲指定
3. **PBR（株価純資産倍率）** - 範囲指定
4. **ROE（自己資本利益率）** - 範囲指定
5. **配当利回り** - 範囲指定（パーセンテージ）
6. **業種・セクター** - 選択式（複数選択可能）
7. **株価** - 範囲指定

**ユーザーアクション:**
- フィルタ条件の入力・選択
- 検索ボタンのクリックによる銘柄検索
- 市場タブの切り替え（日本株/米国株）
- 検索結果のソート（各カラムクリック）
- ページネーションによる結果の閲覧
- データ更新ボタンのクリック

**データ管理:**
- Yahoo Finance APIからのデータ取得
- 検索結果の一時的な保持（セッション内）
- 市場ごとのデータ管理

### 再利用可能性の機会
新規プロジェクトのため、既存コンポーネントの再利用機会はありません。ただし、以下のコンポーネントは今後の機能追加時に再利用可能な設計とする：
- フィルタフォームコンポーネント
- データテーブルコンポーネント（ソート・ページネーション機能付き）
- タブ切り替えコンポーネント
- API通信用のサービス層

### スコープの境界

**スコープ内:**
- 日本株・米国株の銘柄スクリーニング機能
- 7種類のフィルタ条件による絞り込み
- 検索結果のテーブル表示
- ソート・ページネーション機能
- 市場切り替えタブ
- 手動データ更新機能
- Yahoo Finance APIとの連携

**スコープ外:**
- ユーザー認証・ログイン機能
- スクリーニング条件の保存・読み込み機能
- 株価チャート表示
- テクニカル分析機能（移動平均、RSI、MACDなど）
- ポートフォリオ管理機能
- 銘柄のお気に入り・ウォッチリスト機能
- アラート・通知機能
- リアルタイムデータ更新
- 自動データ更新（スケジュール実行）
- エクスポート機能（CSV、PDFなど）

**今後の展望（将来的な拡張候補）:**
- 株価チャート表示機能の追加
- テクニカル分析指標の実装
- ユーザー認証とスクリーニング条件の保存機能
- ポートフォリオ管理機能
- アラート・通知機能
- より高度なフィルタリング条件の追加

### 技術的考慮事項

**データソース:**
- **Yahoo Finance API使用方法:**
  - 非公式の `yfinance` Pythonライブラリを使用（無料）
  - または、RapidAPIなどのサードパーティYahoo Finance APIを使用
  - 注意: 非公式APIのため、利用規約と制限を遵守すること

**API制限とコスト削減策:**
- **レート制限:** Yahoo Finance APIは非公式のため、過度なリクエストによりブロックされる可能性あり
- **対策:**
  - 手動更新ボタン方式の採用（自動更新なし）
  - キャッシング機構の実装（一定時間はキャッシュデータを使用）
  - バッチ処理による効率的なデータ取得
  - リクエスト間隔の制御（レート制限対策）

**無料での実装方法:**
1. **yfinanceライブラリの活用:**
   - Pythonの `yfinance` ライブラリは無料で使用可能
   - 個別銘柄データの取得が可能
   - ただし、全銘柄の一括スクリーニングには制限あり

2. **スクリーニング実装アプローチ:**
   - **オプション1:** 主要銘柄リストを事前に用意し、定期的にバッチ更新
   - **オプション2:** ユーザーがティッカーシンボルリストをアップロード
   - **オプション3:** 市場インデックス構成銘柄のみを対象とする（例: 日経225、S&P 500）
   - **推奨:** オプション3を採用し、段階的に対象銘柄を拡大

3. **データ更新戦略:**
   - 日次バッチ処理で主要銘柄データを取得・キャッシュ
   - ユーザーのスクリーニング実行時はキャッシュデータを使用
   - 手動更新ボタンで最新データを取得（キャッシュ更新）

**技術スタック考慮事項:**
- **バックエンド:** Pythonの使用を推奨（yfinanceライブラリとの親和性）
- **フロントエンド:** React等のモダンなJavaScriptフレームワーク推奨
- **データベース:** 銘柄データのキャッシュ用にPostgreSQLまたはMongoDB
- **非同期処理:** データ取得の非同期処理実装（ユーザー体験向上）

**パフォーマンス考慮事項:**
- ページネーション実装による大量データの効率的な表示
- クライアントサイドでのソート機能（サーバー負荷軽減）
- 検索結果の件数制限（例: 最大500件）
- レスポンシブデザインによるモバイル対応

**データ精度と免責事項:**
- Yahoo Finance APIのデータ精度には限界がある
- アプリケーション内に免責事項を明記する必要あり
- 「投資判断は自己責任で行ってください」等の注意書き

**国際化対応:**
- 日本株と米国株で通貨が異なる（円とドル）
- 業種・セクター分類が市場ごとに異なる可能性
- UIの多言語対応は現時点では不要（日本語のみ）

**エラーハンドリング:**
- API接続エラー時の適切なエラーメッセージ表示
- データ取得失敗時のリトライ機構
- タイムアウト設定の実装

### データスキーマ案

**銘柄データ構造:**
```
{
  ticker: string,          // ティッカーシンボル
  name: string,           // 銘柄名
  market: string,         // 市場（JP/US）
  sector: string,         // セクター
  marketCap: number,      // 時価総額
  per: number,            // PER
  pbr: number,            // PBR
  roe: number,            // ROE（%）
  dividendYield: number,  // 配当利回り（%）
  price: number,          // 現在株価
  currency: string,       // 通貨（JPY/USD）
  lastUpdated: datetime   // 最終更新日時
}
```

**フィルタ条件構造:**
```
{
  market: string,              // 市場選択
  marketCapMin: number,        // 時価総額最小値
  marketCapMax: number,        // 時価総額最大値
  perMin: number,             // PER最小値
  perMax: number,             // PER最大値
  pbrMin: number,             // PBR最小値
  pbrMax: number,             // PBR最大値
  roeMin: number,             // ROE最小値（%）
  roeMax: number,             // ROE最大値（%）
  dividendYieldMin: number,   // 配当利回り最小値（%）
  dividendYieldMax: number,   // 配当利回り最大値（%）
  priceMin: number,           // 株価最小値
  priceMax: number,           // 株価最大値
  sectors: string[]           // 選択されたセクター配列
}
```

### UI/UX考慮事項

**フォームデザイン:**
- 範囲指定フィールドは最小値・最大値を横並びで配置
- セクター選択はチェックボックスまたはマルチセレクトドロップダウン
- 「クリア」ボタンで全条件をリセット
- 入力値のバリデーション（最小値 < 最大値など）

**結果表示テーブル:**
- 列: ティッカー、銘柄名、セクター、時価総額、PER、PBR、ROE、配当利回り、株価
- 各列ヘッダーをクリックでソート（昇順/降順）
- ページネーション（1ページあたり50件程度）
- 総件数の表示

**タブ切り替え:**
- 日本株/米国株のタブを上部に配置
- タブ切り替え時にフィルタ条件をリセット（または個別に保持）

**レスポンシブ対応:**
- モバイル表示では横スクロール可能なテーブル
- フィルタフォームはアコーディオン形式で折りたたみ可能

**ローディング状態:**
- データ取得中はローディングインジケーター表示
- 検索結果が0件の場合は適切なメッセージ表示

### セキュリティ考慮事項

- APIキーの環境変数管理（リポジトリにコミットしない）
- CORS設定の適切な実装
- インプットバリデーション（SQLインジェクション対策）
- レート制限によるDDoS対策

---

**要件調査完了日:** 2026-01-08
**対象仕様:** 銘柄スクリーニングツール
**要件提供者:** ユーザー
**調査担当:** Claude (Spec Researcher)
